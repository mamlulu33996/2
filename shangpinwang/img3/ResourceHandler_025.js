(function(c,a,b){a(function(){var o=true;function g(){a.ajax({url:"/ProductDetail/AjaxCommentTry?r="+Math.random(),type:"get",dataType:"json",async:false,data:{productNo:a("#proId").val()},success:function(v){if(v.Success){if(v.Result==0){o=false}}}})}g();function r(){a.ajax({url:"/ProductDetail/AjaxCommentTotal",type:"get",dataType:"json",data:{productNo:a("#proId").val(),categoryNo:a("#categoryNo").val()},success:function(w){var v=w.Result;if(w.Success){f(v.CommentTotalItems);l(v.Data)}else{console.log(w.Message)}},error:function(v){}})}if(o){r()}function f(x){if(x.length>=1){var v=a(".review_comprehensive");if(v&&v.length>0){var y="0";if(parseInt(x[0].TotalResult)==parseFloat(x[0].TotalResult)&&x[0].TotalResult!="0"){y=x[0].TotalResult+".0"}else{y=x[0].TotalResult}v.find("h6 span").text(y);v.find(">span").removeClass("starlevel_0").addClass("starlevel_"+x[0].Result)}}if(x.length>=2){var y="0";if(parseInt(x[1].TotalResult)==parseFloat(x[1].TotalResult)&&x[1].TotalResult!="0"){y=x[1].TotalResult+".0"}else{y=x[1].TotalResult}var w=a(".review_styles");if(w&&w.length>0){w.find("h6:eq(0)").text(x[1].Name);w.find("span:eq(0)").text(y);w.find("span:eq(1)").removeClass("starlevel_0").addClass("starlevel_"+x[1].Result)}}else{a(".review_styles h6").remove();a(".review_styles .star_class").remove()}if(x.length>=3){var y="0";if(parseInt(x[2].TotalResult)==parseFloat(x[2].TotalResult)&&x[2].TotalResult!="0"){y=x[2].TotalResult+".0"}else{y=x[2].TotalResult}var w=a(".review_styles");if(w&&w.length>0){w.find("h6:eq(1)").text(x[2].Name);w.find("span:eq(2)").text(y);w.find("span:eq(3)").removeClass("starlevel_0").addClass("starlevel_"+x[2].Result)}}else{a(".review_styles h6:eq(1)").remove();a(".review_styles .star_class:eq(1)").remove()}}var h=[];function l(v){if(v==null){a(".review_all>.review_size").hide();return}a.each(v,function(y,z){var A=z;A.sliced=false;A.selected=false;A.visible=true;h.push(A)});a("#container").highcharts({chart:{plotBackgroundColor:null,plotBorderWidth:0,plotShadow:false},title:{text:""},credits:{text:""},tooltip:{pointFormat:"{point.name}: <b>{point.percentage:.1f}%</b>",percentageDecimals:1,enabled:true,formatter:function(){return this.point.y+"%"+this.point.name}},plotOptions:{pie:{allowPointSelect:false,cursor:"pointer",dataLabels:{enabled:false,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:(Highcharts.theme&&Highcharts.theme.contrastTextColor)||"black"}}}},series:[{type:"pie",name:"",data:h}]});var x=0;var w="";a.each(h,function(B,C){var A=C.y;var z=C.name;var y=C.color;if(A>x){x=A;w=z}var D='<li><i style="background:'+y+'"></i>'+A+"%&nbsp;"+z+"</li>";a("#dataListScale").append(D)});a("#dataListScale").prepend('<li class="fontbold font14">尺码<br /><span class="font12"><em>'+x+"%</em>&nbsp;"+w+"</span></li>");a(".review_all>.review_size").show()}function d(z,x,C,y,A){if(!o){return false}var B=a("#proId").val();var w=a("#categoryNo").val();var v=a("#brandNo").val();a.ajax({type:"GET",url:"/productdetail/AjaxCommentList",data:{productNo:B,categoryNo:w,brandNo:v,currentIndex:z,commentShowType:x,gender:y,sortBy:C},dataType:"html",success:function(E){if(E&&E.length>6){if(x==1){if(A){e(true)}a("#spTab_content [tabcontent=mytab-1]>span").html();a("#spTab_content [tabcontent=mytab-1]>span").html(E);a("#spTab_content [tabcontent=mytab-1]>no_review_list").remove();if(A){a("#spTab_content [tabcontent=mytab-1] .no_review_list").hide();var F=parseInt(a("#commentPageCount").val());var D=a("#commentCount").val();a("#spTabs_menu span[tabid=mytab-1] i").text("("+D+")");a(".review_comprehensive div text").text(" "+D+" ");k(a("#pagedListOne"),F)}}else{if(x==2){if(A){e(true)}a("#spTab_content [tabcontent=mytab-2]>span").html();a("#spTab_content [tabcontent=mytab-2]>span").html(E);a("#spTab_content [tabcontent=mytab-2]>no_review_list").remove();if(A){a("#spTab_content [tabcontent=mytab-2] .no_review_list").hide();var F=parseInt(a("#commentWithPicPageCount").val());a("#spTabs_menu span[tabid=mytab-2] i").text("("+a("#commentWitPicCount").val()+")");k(a("#pagedListTwo"),F)}}else{a("#spTabs_menu span[tabid=mytab-3]").show();a("#spTab_content [tabcontent=mytab-3]>span").html();a("#spTab_content [tabcontent=mytab-3]>span").html(E);if(A){var F=parseInt(a("#commentOtherPageCount").val());k(a("#pagedListThree"),F)}}}}else{if(x==1&&A){e(false)}if(x==1){a("#spTab_content [tabcontent=mytab-1] .no_review_list").show()}else{if(x==2){a("#spTab_content [tabcontent=mytab-2] .no_review_list").show()}}}j();n()},error:function(D){console.log(D.responseText)}})}function e(A){var v=a(".review_comprehensive");var z=a(".review_styles");var y=a(".review_size");var x=a(".review_evaluation");var w=a(".review_all");if(A){v.show();z.show();x.show();w.show()}else{v.hide();z.hide();x.hide();w.hide()}}function k(v,x){var y="";if(x>0){y+='<span><a href="javascript:;" class="prev">&lt; 上一页</a></span>';y+='<a href="javascript:;" class="curr">1</a>';if(x>1&&x<=5){for(var w=2;w<=x;w++){y+='<a href="javascript:;">'+w+"</a>"}}else{if(x>5){for(var w=2;w<=5;w++){y+='<a href="javascript:;">'+w+"</a>"}}}y+='<span><a href="javascript:;" class="next"> 下一页&gt;</a></span>'}v.html(y)}function q(){var v=0;var w=1;if(!a("#dateSort").hasClass("curr")){w=2}if(o){d(1,1,w,v,true)}}q();function s(){var v=0;var w=1;if(!a("#dateSort").hasClass("curr")){w=2}if(o){d(1,2,w,v,true)}}s();function t(){var w=a("#proId").val();var v=0;var x=1;if(!a("#dateSort").hasClass("curr")){x=2}if(o){d(1,3,x,v,true)}}t();a("#pagedListOne").delegate("span a","click",function(){var A=parseInt(a("#commentPageCount").val());var B=a("#proId").val();var x=0;var C=1;if(!a("#dateSort").hasClass("curr")){C=2}var v=a("#pagedListOne>a.curr");var w=parseInt(v.text());var z=parseInt(a("#pagedListOne>a:eq(0)").text());var y=parseInt(a("#pagedListOne>a:last").text());if(a(this).text().indexOf("上一页")>-1){if(w<=1){return}d(parseInt(w)-1,1,C,x,false);if(z==1&&w<=5){v.removeClass().prev().addClass("curr")}else{a("#pagedListOne>a").each(function(D){a(this).text(parseInt(a(this).text())-1)})}}else{if(w>=A){return}d(parseInt(w)+1,1,C,x,false);if(y==A||w<5){v.removeClass().next().addClass("curr")}else{a("#pagedListOne>a").each(function(D){a(this).text(parseInt(a(this).text())+1)})}}a("html,body").animate({scrollTop:a("#tab2").offset().top},1000)});a("#pagedListTwo").delegate("span a","click",function(){var B=parseInt(a("#commentWithPicPageCount").val());var A=a("#commentOtherPageCount").val();var C=a("#proId").val();var x=0;var D=1;if(!a("#dateSort").hasClass("curr")){D=2}var v=a("#pagedListTwo>a.curr");var w=parseInt(v.text());var z=parseInt(a("#pagedListTwo>a:eq(0)").text());var y=parseInt(a("#pagedListTwo>a:last").text());if(a(this).text().indexOf("上一页")>-1){if(w<=1){return}d(parseInt(w)-1,2,D,x,false);if(z==1&&w<=5){v.removeClass().prev().addClass("curr")}else{a("#pagedListTwo>a").each(function(E){a(this).text(parseInt(a(this).text())-1)})}}else{if(w>=B){return}d(parseInt(w)+1,2,D,x,false);if(y==B||w<5){v.removeClass().next().addClass("curr")}else{a("#pagedListTwo>a").each(function(E){a(this).text(parseInt(a(this).text())+1)})}}a("html,body").animate({scrollTop:a("#tab2").offset().top},1000)});a("#pagedListThree").delegate("span a","click",function(){var A=parseInt(a("#commentOtherPageCount").val());var B=a("#proId").val();var x=0;var C=1;if(!a("#dateSort").hasClass("curr")){C=2}var v=a("#pagedListThree>a.curr");var w=parseInt(v.text());var z=parseInt(a("#pagedListThree>a:eq(0)").text());var y=parseInt(a("#pagedListThree>a:last").text());if(a(this).text().indexOf("上一页")>-1){if(w<=1){return}d(parseInt(w)-1,3,C,x,false);if(z==1&&w<=5){v.removeClass().prev().addClass("curr")}else{a("#pagedListThree>a").each(function(D){a(this).text(parseInt(a(this).text())-1)})}}else{if(w>=A){return}d(parseInt(w)+1,3,C,x,false);if(y==A||w<5){v.removeClass().next().addClass("curr")}else{a("#pagedListThree>a").each(function(D){a(this).text(parseInt(a(this).text())+1)})}}a("html,body").animate({scrollTop:a("#tab2").offset().top},1000)});a("#pagedListOne>a").live("click",function(){$this=a(this);if($this.hasClass("curr")){return}var x=a("#proId").val();var v=0;var y=1;if(!a("#dateSort").hasClass("curr")){y=2}var w=$this.text();if(w&&w.length>0){d(w,1,y,v,false)}$this.removeClass().addClass("curr").siblings().removeClass();a("html,body").animate({scrollTop:a("#tab2").offset().top},1000)});a("#pagedListTwo>a").live("click",function(){$this=a(this);if($this.hasClass("curr")){return}var x=a("#proId").val();var v=0;var y=1;if(!a("#dateSort").hasClass("curr")){y=2}var w=$this.text();if(w&&w.length>0){d(w,2,y,v,false)}$this.removeClass().addClass("curr").siblings().removeClass();a("html,body").animate({scrollTop:a("#tab2").offset().top},1000)});a("#pagedListThree>a").live("click",function(){var v=a(this);if(v.hasClass("curr")){return}var y=a("#proId").val();var w=0;var z=1;if(!a("#dateSort").hasClass("curr")){z=2}var x=v.text();if(x&&x.length>0){d(x,3,z,w,false)}v.removeClass().addClass("curr").siblings().removeClass();a("html,body").animate({scrollTop:a("#tab2").offset().top},1000)});a("#spTabs_menu>div>a").click(function(){var w=a(this);if(w.hasClass("curr")){return}var C=a("#proId").val();var y=0;var x=a("#pagedListOne>a.curr").text();var B=a("#pagedListTwo>a.curr").text();var A=a("#pagedListThree>a.curr").text();var z=w.attr("id");if(z.length>0&&z=="dateSort"){if(x&&x.length>0){d(1,1,1,y,false);var v=a("#pagedListOne>a:eq(0)").text();a("#pagedListOne>a:eq(0)").removeClass("curr").addClass("curr").siblings().removeClass("curr");if(a("#pagedListOne>a:eq(0)").text()!="1"){i("#pagedListOne>a",parseInt(v))}}if(B&&B.length>0){d(1,2,1,y,false);var v=a("#pagedListTwo>a:eq(0)").text();a("#pagedListTwo>a:eq(0)").removeClass("curr").addClass("curr").siblings().removeClass("curr");if(a("#pagedListTwo>a:eq(0)").text()!="1"){i("#pagedListTwo>a",parseInt(v))}}if(A&&A.length>0){d(1,3,1,y,false);a("#pagedListThree>a:eq(0)").removeClass("curr").addClass("curr").siblings().removeClass("curr");var v=a("#pagedListThree>a:eq(0)").text();if(a("#pagedListThree>a:eq(0)").text()!="1"){i("#pagedListThree>a",parseInt(v))}}}else{if(x&&x.length>0){d(1,1,2,y,false);var v=a("#pagedListOne>a:eq(0)").text();if(a("#pagedListOne>a:eq(0)").text()!="1"){i("#pagedListOne>a",parseInt(v))}a("#pagedListOne>a:eq(0)").removeClass("curr").addClass("curr").siblings().removeClass("curr")}if(B&&B.length>0){d(1,2,2,y,false);var v=a("#pagedListTwo>a:eq(0)").text();if(a("#pagedListTwo>a:eq(0)").text()!="1"){i("#pagedListTwo>a",parseInt(v))}a("#pagedListTwo>a:eq(0)").removeClass("curr").addClass("curr").siblings().removeClass("curr")}if(A&&A.length>0){d(1,3,2,y,false);var v=a("#pagedListThree>a:eq(0)").text();if(a("#pagedListThree>a:eq(0)").text()!="1"){i("#pagedListThree>a",parseInt(v))}a("#pagedListThree>a:eq(0)").removeClass("curr").addClass("curr").siblings().removeClass("curr")}}w.removeClass().addClass("curr").siblings().removeClass()});function i(v,w){a(v).each(function(x){a(this).text(a(this).text()-w+1)})}function n(){a(".review_list .right_cont .comment_imgs").find("img").each(function(w,v){if(a(this).attr("lazy")!=""){a(this).attr("src",a(this).attr("lazy"))}if(a(this).attr("path")!=""){a(this).attr("src",a(this).attr("path"))}})}function j(){a(".skuAttrText").each(function(w,y){var z="";a(y).siblings().filter(":contains('颜色'),:contains('尺码')").remove();var B=a(y).attr("skuattr");if(B.length>0){var v=B.split("  ");for(var x=0;x<v.length;x++){if(v[x].indexOf(":")>-1&&v[x].indexOf("颜色")>-1){var A="颜色/"+v[x].split(":")[1];if(z==""){a(y).html(A)}else{a(y).after("<span class='padt15 padl30'>"+A+"</span>")}z+=A}else{if(v[x].indexOf(":")>-1&&v[x].indexOf("尺码")>-1){var A="尺码/"+v[x].split(":")[1];if(z==""){a(y).html(A)}else{a(y).after("<span class='padt15 padl30'>"+A+"</span>")}z+=A}}}}})}if(a("#spTabs").length>0){var p=SP.plug.tab.create({wrapper:"#spTabs",contentWrapper:"#spTab_content",first:"mytab-1",trigger:"click",effector:"direct",curClass:"curr",auto:false});var u=function(){var x=a(this).offset().left,y=a(this).offset().top,B=a(c).scrollTop(),A=a(c).height(),z=(y-B)>A/2?"top":"bottom";a(this).next(".imgBigBox").show();var w=a(this).next(".imgBigBox").find("img").width(),v=a(this).next(".imgBigBox").find("img").height();if(z=="top"){a(this).next(".imgBigBox").css({left:(x+50)-(w/2),top:y-v})}else{a(this).next(".imgBigBox").css({left:(x+50)-(w/2),top:y+150})}return false},m=function(){a(this).closest("div.image_big").next(".imgBigBox").hide()};a(".comment_imgs .image_big").live("mouseover",u);a(".comment_imgs .image_big").live("mouseout",m)}n()})})(window,jQuery);