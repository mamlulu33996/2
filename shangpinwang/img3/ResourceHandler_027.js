$(function(){$("#spDetail_b_buy").bind("click",function(){var k=$("#proId").val();var h=$("#NewShangpinTradeDomainUrl").val();var n=$("#topicno").val();var p=$("#vipno").val();var o=$("#orderType").val();var l=0,d=0;var j=$("#spDetail_sb_msg");var i=$("#favmsg");var g="";var e,m="";l=$("#emCount").text();if(!l||l<=0){i.html("&nbsp;");j.html("请选择商品数量").show();return}if($("#spDetail_proColor").length>0){g=$("#spDetail_proColor").find("span.limg_on,span.limg_ison");if(g.length==0){i.html("&nbsp;");j.html("请选择商品颜色").show();return}else{m=g.attr("skuno")}}var f=$("#spDetail_proChima");if(f.length>0){e=f.find("li.lcm_on,li.lcm_ison");if(e.length==0){i.html("&nbsp;");j.html("请选择商品尺码").show();return}else{m=e.attr("skuno")}}if($("#spDetail_proColor").length==0&&f.length==0){m=$("#skuno").val()}j.html("&nbsp;");i.html("&nbsp;");$(this).hide().after("<i style='width:202px; height: 31px;line-height: 30px; margin: 0 7px 0 0;' class=\"loading flt\">正在提交...</i>");$.ajax({type:"get",dataType:"jsonp",jsonp:"callback",url:h+"/trade/addproducttocart",async:true,data:{skuNo:m,productNo:k,quantity:l,categoryNo:n,type:o},success:function(c){if(c.Success==true){$("#spDetail_b_buy").fadeIn(500).next("i.loading").remove();SP.config.shopcart.get(false,false,false,false,function(){var q=$("#spNewHeader_shopcart").offset().left;if($("#alIndex_top_notice").is(":visible")){$("#spPlug_shopcart").show().css({top:"137px",left:q-156})}else{$("#spPlug_shopcart").show().css({top:"28px",left:q-156})}$("#spNewHeader_shopcart").addClass("on");$("html,body").stop().animate({scrollTop:0},100)})}else{j.html(c.Err).fadeIn(500);$("#spDetail_b_buy").fadeIn(500).closest("div").find("i.loading").remove()}}})});function b(){var c=$.ajax({type:"post",url:"/login/isauthenticated",async:false});return c}$("#buyNow001").bind("click",function(){if($("#isOutside").val()=="2"){a()}else{var m=$("#proId").val();var k=$("#NewShangpinLoginDomainUrl").val();var i=$("#NewShangpinTradeDomainUrl").val();var p=$("#topicno").val();var s=$("#vipno").val();var r=$("#orderType").val();var n=0,e=0;var l=$("#spDetail_sb_msg");var j=$("#favmsg");var h;var f,o="";n=$("#emCount").text();if(!n||n<=0){j.html("&nbsp;");l.html("请选择商品数量").show();return}var d=$("#spDetail_proColor");if(d&&d.length>0){h=d.find("span.limg_on,span.limg_ison");if(h.length==0){j.html("&nbsp;");l.html("请选择商品颜色").show();return}else{o=h.attr("skuno")}}var g=$("#spDetail_proChima");if(g.length>0){f=g.find("li.lcm_on,li.lcm_ison");if(f.length==0){j.html("&nbsp;");l.html("请选择商品尺码").show();return}else{o=f.attr("skuno")}}if(d.length==0&&g.length==0){o=$("#skuno").val()}l.html("&nbsp;");j.html("&nbsp;");$(this).hide().closest("div").prepend("<i style='width:202px; height: 31px;line-height: 30px; margin: 0 7px 0 0;' class=\"loading flt\">正在提交...</i>");$.ajax({url:$("#NewShangpinLoginDomainUrl").val()+"/login/IsAuthenticatedNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp"}).done(function(c){if(c.IsAuthenticated==1){$.ajax({type:"get",dataType:"jsonp",jsonp:"callback",url:i+"/trade/GoToOrder",async:true,data:{skuNo:o,productNo:m,quantity:n,categoryNo:$("#topicno").val(),type:r},success:function(u){if(u.Success==true){location.href=i+"/trade/order/"+u.Result+"/3"}else{l.html(u.Err).fadeIn(500);$("#buyNow001").fadeIn(500).closest("div").find("i.loading").remove()}}})}else{var t=$("#topicno").val();var q=$("#NewShangpinDomainUrl").val();if(t!=undefined&&t!=""){location.href=k+"/register?returnUrl="+q+escape("/product/"+t+"/"+$("#proId").val()+"-"+o)}else{location.href=k+"/register?returnUrl="+q+escape("/product/"+$("#proId").val()+"-"+o)}}})}});function a(){var m=$("#proId").val();var k=$("#NewShangpinLoginDomainUrl").val();var i=$("#NewShangpinTradeDomainUrl").val();var p=$("#topicno").val();var s=$("#vipno").val();var r=$("#orderType").val();var n=0,e=0;var l=$("#spDetail_sb_msg");var j=$("#favmsg");var h;var f,o="";n=$("#emCount").text();if(!n||n<=0){j.html("&nbsp;");l.html("请选择商品数量").show();return}var d=$("#spDetail_proColor");if(d&&d.length>0){h=d.find("span.limg_on,span.limg_ison");if(h.length==0){j.html("&nbsp;");l.html("请选择商品颜色").show();return}else{o=h.attr("skuno")}}var g=$("#spDetail_proChima");if(g.length>0){f=g.find("li.lcm_on,li.lcm_ison");if(f.length==0){j.html("&nbsp;");l.html("请选择商品尺码").show();return}else{o=f.attr("skuno")}}if(d.length==0&&g.length==0){o=$("#skuno").val()}l.html("&nbsp;");j.html("&nbsp;");$("#buyNow001").hide().closest("div").prepend("<i style='width:202px; height: 31px;line-height: 30px; margin: 0 7px 0 0;' class=\"loading flt\">正在提交...</i>");$.ajax({url:$("#NewShangpinLoginDomainUrl").val()+"/login/IsAuthenticatedNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp"}).done(function(c){if(c.IsAuthenticated==1){$.ajax({type:"get",dataType:"jsonp",jsonp:"callback",url:i+"/trade/GoToOrder",async:true,data:{skuNo:o,productNo:m,quantity:n,categoryNo:$("#topicno").val(),type:r},success:function(u){if(u.Success==true){location.href=i+"/trade/order/"+u.Result+"/3"}else{l.html(u.Err).fadeIn(500);$("#buyNow001").fadeIn(500).closest("div").find("i.loading").remove()}}})}else{var t=$("#topicno").val();var q=$("#NewShangpinDomainUrl").val();if(t!=undefined&&t!=""){location.href=k+"/register?returnUrl="+q+escape("/product/"+t+"/"+$("#proId").val()+"-"+o)}else{location.href=k+"/register?returnUrl="+q+escape("/product/"+$("#proId").val()+"-"+o)}}})}});function AddFavoriteBrand(a){var c="/account/AddFavoriteBrand";var b=false;return $.ajax({type:"POST",url:c,data:{brandNo:a},timeout:12000,dataType:"json",error:function(e,d){},success:function(d){if(d.UserData.Success=="1"){return true}else{return false}}})}function logStatus(){var a=$.ajax({type:"post",url:"/login/IsAuthenticated",async:false});return a}function checkLoginStatus(){var a=0;$.ajax({url:$("#NewShangpinLoginDomainUrl").val()+"/login/IsAuthenticatedNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp",async:false}).done(function(b){if(b){return b.IsAuthenticated}});return a}function AddFavoriteProductNoNew(g,a,e,b){var f=$("#topicno").val();var d=$("#NewShangpinAccountDomainUrl").val()+"/account/AddFavoriteProductNew";var c=$.ajax({type:"get",url:d,jsonp:"callback",dataType:"jsonp",data:{type:g,productNo:a,skuNo:e,price:b,topicno:f}});return c}$(function(){$("#buyNow").bind("click",function(){if($("#buyNow").html().indexOf("已")>-1){return false}var a=$("#NewShangpinLoginDomainUrl").val();$.ajax({url:$("#NewShangpinLoginDomainUrl").val()+"/login/IsAuthenticatedNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp"}).done(function(e){if(e.IsAuthenticated==1){var h=$("#favmsg"),b=$("#spDetail_sb_msg");var j=$("#proId").val();var i=$("#SP_ProdPrice").val();var d=$("#spDetail_proColor");var l="";if(d.length>0){d=d.find("span.limg_on,span.limg_ison");if(d.length==0){b.html("&nbsp;");h.html("请选择商品颜色");return}else{l=d.attr("skuno")}}var c=$("#spDetail_proChima");if(c&&c.length>0){if(c.find("li.lcm_on,li.lcm_ison").length==0){b.html("&nbsp;");h.html("请选择商品尺码");return}else{c=c.find("li.lcm_on,li.lcm_ison");l=c.attr("skuno")}}if($("#spDetail_proColor").length==0&&c.length==0){l=$("#skuno").val()}h.html("&nbsp;");b.html("&nbsp;");var g=j+"_"+d.attr("value");if(c.length>0){g=g+"_"+c.find("li.lcm_on,li.lcm_ison").attr("val")}$.ajax({url:$("#NewShangpinAccountDomainUrl").val()+"/account/AddFavoriteProductNew?r="+Math.random(),type:"get",jsonp:"callback",dataType:"jsonp",data:{type:"2",productNo:j,skuNo:l,price:i,topicno:$("#topicno").val()}}).done(function(n){if(n.UserData!=null&&n.UserData.Success=="1"){$(".wash_content").html("成功加入愿望清单");$(".buy_now").html("已加入愿望清单");$(".wash_box").show();setTimeout(function(){$(".wash_box").hide()},2000)}else{$(".wash_content").html("对不起，收藏失败！");$(".wash_box").show();setTimeout(function(){$(".wash_box").hide()},2000)}setTimeout(function(){h.html("&nbsp;").css({"background-image":"","padding-left":"0px"})},1500)})}else{var m=$("#topicno").val();var f=parseInt($("#gender").val(),0)==1?"/men":"/women";var k=$("#NewShangpinDomainUrl").val();if(m!=undefined&&m!=""){location.href=a+"/register?returnUrl="+k+escape("/product/"+m+"/"+$("#proId").val())}else{location.href=a+"/register?returnUrl="+k+escape("/product/"+$("#proId").val())}}})})});function AddFavoriteProductNo(g,a,e,b){var f=$("#topicno").val();var d="/account/AddFavoriteProduct";var c=$.ajax({type:"post",url:d,async:false,data:{type:g,productNo:a,skuNo:e,price:b,topicno:f}});return c}function addShopCart(d,e,b,a,c){DirectAddSHopcart(d,e,b,a)}function DirectAddSHopcart(c,d,b,a){$.ajax({type:"POST",url:"/account/AddFavoriteProductToCart",data:{productNo:c,productHashText:a,topicNo:b},dataType:"json",success:function(e){if(e.Success){window.location.href="/trade/Cart"}else{alert(e.Err)}}})}function getFavoriteProductColorAndSize(b,h,f,e,g,a){var d="/account/GetProductColorAndSize";var c=false;return $.ajax({type:"POST",url:d,data:{productNo:b,skuNo:h,skuAttrText:f,sizeStandard:e,skuHashText:g,productCategoryNo:a},timeout:12000,async:false,dataType:"json",success:function(i){if(i.UserData.Success=="1"){$("span#"+h).text(i.UserData.Message)}}})}function elCardUrlHref(a){window.location.href=a};