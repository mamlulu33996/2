(function(d,a,c){var b=(function(){var f=a("<iframe>").attr({id:"sp_framefix",name:"sp_framefix",frameborder:0,marginwidth:0,marginheight:0,scrolling:"no"}).css({position:"absolute",display:"none","z-index":999}),g,h=function(){if(g){return true}a("body").append(f);return g=true};return{get:function(){return f},hide:function(){f.hide();return this},bindTo:function(l){if(!g){h()}if(!l){return this}var m=l,k=0,p=0,q=0,j=0,n,i=f,r=1000;if(m&&m.size()==1){n=m.offset();k=n.left;p=n.top;q=l.width();j=l.height();r=Math.floor(new Date().getTime()/1000);i.css({left:k+"px",top:p+"px",height:j+"px",width:q+"px"}).show();m.css({"z-index":r+10})}return this}}})();var e=(function(){var i=false;var h={};var f=null;var j;function g(){function k(n,o,m){var l=n;this.focusWidth=o||150;this.focusHeight=m||150;this.getImageObject=function(){return l}}k.prototype.run=function(){var n=this.getImageObject();var l=this;var m=this.focusWidth+""+this.focusHeight;n.bind("mousemove.zoom",function(o){if(typeof h[m]=="undefined"){h[m]=l.createFocus(l.focusWidth,l.focusHeight)}h[m].show(o,n);return false})};k.prototype.createFocus=function(n,m){n=n||150;m=m||150;var l={_width:n,_height:m,zoomer:{},object:(function(){var o=a("<div>").attr("id","imgfocus"+n+m).css({position:"absolute",width:n+"px",height:m+"px",border:"1px solid #aaa","background-color":"#ddd",opacity:0.5,display:"none","z-index":100});a("body").append(o);return o})(),show:function(p,q){this.bind(p,q);var o=this;a(document).bind("mousemove.zoom",function(r){o.bind(r,q)});this.object.mouseout(function(){o.hide(q);return false})},hide:function(o){clearTimeout(f);f=null;a(document).unbind(".zoom");this.object.unbind("mouseout");this.object.hide();var p="zoom_"+o.attr("id");if(typeof this.zoomer[p]!="undefined"){this.zoomer[p].hide()}},bind:function(r,x){if(x.css("display")=="none"){this.hide(x);return}r=r||d.event;var B=r.clientX+a(d).scrollLeft();var C=r.clientY+a(d).scrollTop();var t=C-m/2,s=B-n/2;var z=x.offset().top,w=x.offset().left;var u=z+x.height(),y=w+x.width();var A=x.width(),v=x.height();if(t<z){t=z}if(t>u-this._height){t=u-this._height}if(s<w){s=w}if(s>y-this._width){s=y-this._width}this.object.css({top:t+"px",left:s+"px",display:"block",cursor:"crosshair"});var o=this;j=r.srcElement?r.srcElement:r.target;setTimeout(function(){if(j.id!=o.object.attr("id")){o.hide(x)}},100);var q=t-z;var p=s-w;var D={mouseX:B,mouseY:C,imgTop:z,imgLeft:w,imgBottom:u,imgRight:y,imgWidth:A,imgHeight:v,focusTop:t,focusLeft:s,focusWidth:o._width,focusHeight:o._height,bgTop:q,bgLeft:p};this.showZoomer(x,D)},showZoomer:function(p,q){var o=this;var s="zoom_"+p.attr("id");if(typeof o.zoomer[s]=="undefined"){o.zoomer[s]=o.createZoomer(p,q)}var r=o.zoomer[s];this.positionZoomer(r,q);if(r.proportion==null){r.proportion=o.lazyload(p,q,r)}r.show().reposition(q.bgLeft,q.bgTop)},positionZoomer:function(p,o){p.obj.css({top:o.imgTop+"px",left:(o.imgLeft+o.imgWidth+10)+"px"})},createZoomer:function(q,s){var p=q.attr("focussrc");if(typeof p=="undefined"||p=="#"||p.indexOf("/e.gif")>=0){return null}var o=a("<div>").attr("id","zoom_"+q.attr("id")).css({position:"absolute",top:s.imgTop+"px",left:(s.imgLeft+s.imgWidth+10)+"px",width:"200px",height:"32px","line-height":"32px",border:"1px solid #ddd","background-color":"#fff","text-align":"center"}).html("正在加载商品大图，请稍后...");a("body").append(o);var r={obj:o,show:function(){this.obj.show();b.bindTo(this.obj);return this},hide:function(){this.obj.hide();b.hide();return this},reposition:function(t,u){if(this.proportion==null){return this}t=t||0;u=u||0;t=Math.floor(t*this.proportion.width);u=Math.floor(u*this.proportion.height);this.obj.css({"background-position":"-"+t+"px -"+u+"px"});return this},proportion:null};return r},lazyload:function(q,s,r){var p=q.attr("focussrc");var o=r.obj;clearInterval(f);f=null;f=setTimeout(function(){var t=new Image();t.src=p;if(t.complete){var v=t.width/s.imgWidth,u=t.height/s.imgHeight;o.css({width:(s.focusWidth*v)+"px",height:(s.focusHeight*u)+"px",background:"url("+t.src+") no-repeat 0 0"}).html("");r.proportion={width:v,height:u};r.reposition(s.bgLeft,s.bgTop)}else{t.onload=function(){var x=t.width/s.imgWidth,w=t.height/s.imgHeight;o.css({width:(s.focusWidth*x)+"px",height:(s.focusHeight*w)+"px",background:"url("+t.src+") no-repeat 0 0"}).html("");r.proportion={width:x,height:w};r.reposition(s.bgLeft,s.bgTop)}}},10);return r.proportion}};return l};return{Zoomer:function(m,n,l){return new k(m,n,l)}}}return function(l,m,k){if(!i){i=g()}var n=i.Zoomer(l,m,k);n.run();return n}})();c.plug.zoom=e})(window,jQuery,SP,undefined);(function(d,a,c){var b=function(h,e,i){var g=h,f=0,j={};this.container=e;this.prefix=i;this.images=function(){return g};this.current=function(k){if(arguments.length==0){return f}f=isFinite(k)?k:0;return f};this.status=function(k,l){if(typeof j[k]=="undefined"||j[k]!==true){j[k]=l||false}return j[k]}};b.prototype={constructor:b,load:function(h,e,f,g){var i=this;return a("<img>").load(function(){f&&f.call(i,a(this),g||0)}).attr("src",h).css(e)},size:function(){return this.images().length},prefixed:function(e){return a("#"+this.prefix+"_"+e)},cursor:function(){return this.prefixed(this.current())},get:function(f,e){var g,h=this.size();if(h<1){return null}if(h-1<f||f<0){f=0}g=this.prefixed(f);if(g.size()==0){g=this.load(this.images()[f],{display:"none"},function(i,j){this.status(j,true);if(this.current()==j){i.show()}},f).attr("id",this.prefix+"_"+f)}return{index:f,elem:g}},show:function(g,f){var h=this.get(g);if(!h){return this}var e=h.elem,g=h.index;if(h&&(!this.init||this.current()!=g)){this.cursor().hide();this.current(g);this.container.append(e);if(this.status(g)){e.show()}f&&f.call(this,e)}return this},initFirst:function(e){this.show(0,e);this.init=1;return this}};b.create=function(f,e,g){return new b(f,e,g)};c.plug.imgloader=b})(window,jQuery,SP,undefined);