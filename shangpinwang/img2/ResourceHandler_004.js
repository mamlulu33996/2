$(function(){var j,h,i,d=$('<div class="miniConfirm"><i></i><p>确定删除此商品？</p><p><a class="del_ok button" href="javascript:;">确定</a><a class="del_cancle button" href="javascript:;">取消</a></p></div>'),a=function(){h=null;d.hide()},c=false,e=function(p){var l=$("#spPlug_shopcart_wrapper li[prodid='"+p+"']");var o=l.find(".shopcart_price .price").text().replace("￥","").replace(/,/g,"").replace(" ",""),n=l.find(".shopcart_price i").text().replace("x","").replace(" ",""),k=$("#spPlug_shopcart").find(".relt .price").text().replace("￥","").replace(/,/g,"").replace(" ","");var m=String(k-o*n).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");$("#spPlug_shopcart").find(".relt .price").text("￥ "+m)},f=function(k){if(k<=4){$("#spPlug_shopcart_wrapper").css({"overflow-y":"hidden"})}else{$("#spPlug_shopcart_wrapper").css({"overflow-y":"scroll"})}if(k<4){$("#spPlug_shopcart_wrapper").stop().animate({height:90*k},200)}if(k==0){$("#spPlug_shopcart_wrapper").stop().animate({height:"50"},200).html('<ins class="soldOut"><p>您的购物车中暂无商品，</p><p>快去挑选自己钟爱的商品吧！</p></ins>');$("#spPlug_shopcart .relt").hide();$("#spPlug_shopcart_prev , #spPlug_shopcart_next").hide()}};$(document).delegate(".del_cancle","click",function(){if(h){i=j.current();j.scrollTo(i);a();j.__elems=$("#spPlug_shopcart_wrapper li");if(j.__elems.length==1){$("#spPlug_shopcart_wrapper").stop().animate({height:"90"},200)}}});$(document).delegate(".del_ok","click",function(){var k=deleteShoppingCartItem(h);if(k){if(h){__this=$(this);e(h);$("#spPlug_shopcart_wrapper li[prodid='"+h+"']").slideUp(300,function(){$(this).remove();j.__elems=$("#spPlug_shopcart_wrapper li");i=j.current();j.scrollTo(i);if(j.__elems.length-1<2){$("#spPlug_shopcart_prev , #spPlug_shopcart_next").hide()}f(j.__elems.length,__this)});a()}}});SP.config.menu=SP.plug.menu({event:"hover",title:{obj:["#spNewHeader_usercenter","#spHeader_order"],on:function(){$(this).addClass("on")},off:function(){$(this).removeClass("on")}},content:{obj:["#spNewHeader_usercenter_content",function(){var k=$("#spHeader_order_content");if(k.length==0){k=$("<div>").attr("id","spHeader_order_content").addClass("sp-menu-content").addClass("shad-x1y1b5-ddd").addClass("clr").html('<dl class="flt"><dd><a href="#">待支付订单&nbsp;(1)</a></dd><dd><a href="#">全部订单</a></dd></dl>');$("body").append(k)}return k}],fix:"#sp_newHeader"}});isOne=false;SP.plug.menu({event:"hover",title:{obj:["#spMenu_new","#spMenu_women","#spMenu_men","#spMenu_shoes","#spMenu_menshoes","#spMenu_bags","#spMenu_accessories","#spMenu_beauty","#spMenu_home",,"#spMenu_brand","#spMenu_top"],on:function(){$(this).addClass("on")},off:function(){$(this).removeClass("on")}},content:{obj:[$("#sp-new-cont"),$("#sp-women-cont"),$("#sp-men-cont"),$("#sp-shoes-cont"),$("#sp-menshoes-cont"),$("#sp-bags-cont"),$("#sp-accessories-cont"),$("#sp-beauty-cont"),$("#sp-home-cont"),,$("#sp-brand-cont"),$("#sp-top-cont")],fix:"#sp_newHeader"},render:{beforeOne:function(){var q=this.contentObj.width();if(q<120){this.contentObj.css("width","120px")}else{this.contentObj.css("width",q+1)}var p=this.contentObj.find(".sp-menu-img .imgFocus"),n=p.find("a"),m=n.length,k=0,o=1000,l;if(p.length>0){clearInterval(l);if(!isOne){isOne=true;l=setInterval(function(){k++;if(k==m){k=0}n.eq(k).show().siblings("a").hide()},o)}this.titleObj.hover(function(){clearInterval(l);l=setInterval(function(){k++;if(k==m){k=0}n.eq(k).show().siblings("a").hide()},o)},function(){clearInterval(l);isOne=false});this.contentObj.hover(function(){clearInterval(l);l=setInterval(function(){k++;if(k==m){k=0}n.eq(k).show().siblings("a").hide()},o)},function(){clearInterval(l)});p.hover(function(){clearInterval(l)},function(){clearInterval(l);l=setInterval(function(){k++;if(k==m){k=0}n.eq(k).show().siblings("a").hide()},o)})}}},offset:{top:3}});SP.plug.menu({event:"hover",title:{obj:"#sp_newHeader_type",on:function(){$(this).addClass("on")},off:function(){$(this).removeClass("on")}},content:{obj:$("#sp_newHeader_typeBox"),fix:"#sp_newHeader"}});SP.plug.menu({event:"hover",title:{obj:["#spNewHeader_mobile","#spNewHeader_weixin"],on:function(){$(this).addClass("on")},off:function(){$(this).removeClass("on")}},content:{obj:[$("#spNewHeader_mobile_content"),$("#spNewHeader_weixin_content")],fix:"#sp_newHeader"}});var g=$("#spPlug_shopcart");if(g.length==0){g=$("<div>").attr("id","spPlug_shopcart");$("body").append(g)}g.delegate(".arr-up-end_new,.arr-up_new,.arr-down-end_new,.arr-down_new","hover",function(k){if($(this).attr("id")=="spPlug_shopcart_prev"){if(k.type=="mouseenter"){$(this).addClass("cart_hover")}else{if(k.type=="mouseleave"){$(this).removeClass("cart_hover")}}}else{if(k.type=="mouseenter"){$(this).addClass("cart_hover2")}else{if(k.type=="mouseleave"){$(this).removeClass("cart_hover2")}}}});g.delegate(".alShopcart_del","click",function(n){var l=$(this),k=l.closest("li"),m;h=k.attr("prodid");var o="";if($("#NewShangpinTradeDomainUrl").length>0){o=$("#NewShangpinTradeDomainUrl").val()}if(h){$.ajax({type:"Get",url:o+"/trade/DeleteCartDetail",data:{shoppingCartDetailId:h},success:function(q){if(q.Success){var p=$(this);e(h);f($("#spPlug_shopcart_wrapper li").length-1,p);$("#spPlug_shopcart_wrapper li[prodid='"+h+"']").slideUp(300,function(){$(this).remove()});$("#cartTotalAmount").text("￥ "+calculateShopcartTotalAmount(h));calculateProductCount(h);a()}},dataType:"JSONP"})}});calculateShopcartTotalAmount=function(l){var k=0;$("#spPlug_shopcart_wrapper li[prodid!='"+l+"']").each(function(n){var o=parseFloat($(this).attr("price"));var m=parseInt($(this).attr("count"));k+=o*m});return b(k)};function b(k){k=k+"";if(k.indexOf(".")==0){k="0"+k}if(k.indexOf(".")=="-1"){k=k}else{if(k.indexOf(".")+2==k.length){k=k+"0"}else{k=k.replace(/([0-9]+.[0-9]{2})[0-9]*/,"$1")}if(k.indexOf(".00")>0){k=k.replace(".00","")}}return k}calculateProductCount=function(l){var k=0;$("#spPlug_shopcart_wrapper li[prodid!='"+l+"']").each(function(n){var m=parseInt($(this).attr("count"));k+=m});$("#spNewHeader_shopcart>ins").text("("+k+")");$("#spPlug_shopcart").find(".relt i").text(k)};SP.plug.shopcart.config({container:g,URI:{get:$("#NewShangpinTradeDomainUrl").val()+"/trade/minicart",add:"addtest.txt"},render:{init:function(){var k=this.container,l=this;SP.plug.menu({event:"hover",title:{obj:"#spNewHeader_shopcart",on:function(){$(this).addClass("on")},off:function(){$(this).removeClass("on")}},content:{obj:k,fix:"#sp_newHeader_loginForm"}});$("#spNewHeader_shopcart").hover(function(){l.get()},function(){})},onget:function(){this.container.html('<i class="coverLine"></i>正在加载')},onload:function(p,n){var o=this.container,z="",x,w,y;d=$('<div class="miniConfirm"><i></i><p>确定删除此商品？</p><p><a class="del_ok button" href="javascript:;">确定</a><a class="del_cancle button" href="javascript:;">取消</a></p></div>'),p=this.getPrivate("data");n=this.getPrivate("attach");w=p&&p.list;if(!p||!w.length){o.html('<i class="coverLine"></i><ins class="soldOut"><p>您的购物车中暂无商品，</p><p>快去挑选自己钟爱的商品吧！</p></ins>');$("#spNewHeader_shopcart>ins").text("(0)")}else{x=w.length;var s="";if($("#isLogin").val().length>0){s=$("#NewShangpinTradeDomainUrl").val()+"/trade/cart"}else{s=$("#NewShangpinLoginDomainUrl").val()+"/register?returnUrl="+$("#NewShangpinTradeDomainUrl").val()+"/trade/cart#signIn"}z+='<i class="coverLine"></i>';z+='<div class="relt zom">';z+="<p>数量共计：<i>"+p.count+"</i>件</p>";z+='<p>金额共计：<strong class="price" id="cartTotalAmount">￥&nbsp;'+p.totalprice+"</strong></p>";z+='<a href="'+s+'" id="spPlug_shopcart_submit" title="结算" class="abs">结算</a>';z+="</div>";var r="";for(var q=0;q<x;q++){r+=w[q]["skuNo"]+","}var m=new Array();var k;if(x>4){k="height: 380px"}else{k="height: "+(95*x)+"px; overflow-y: hidden;"}z+='<div id="spPlug_shopcart_wrapper" style="'+k+'"><ul>';for(var t=0,v=x;t<v;t++){y=w[t];if(y.source=="1"){z+='<li class="overseas clr" prodid="'+y.id+'" price="'+y.price+'" count="'+y.count+'">'}else{z+='<li class="clr" prodid="'+y.id+'" price="'+y.price+'" count="'+y.count+'">'}z+='<span class="prodimg">';z+='<a href="'+y.url+'" title="'+y.name+'">';z+='<img src="'+y.img+'" alt="'+y.name+'" width="70" height="90" />';z+="</a>";z+="</span>";z+='<span class="prodinfo">';z+='<p><a href="'+y.url+'" title="'+y.brandname+y.name+'" class="a-black">'+y.brandname+"</a></p>";z+='<p><a href="'+y.url+'" title="'+y.brandname+y.name+'" class="a-gray">'+y.name+"</a></p>";z+='<p class="shopcart_price">';if(y.priceType=="0"){z+='<strong class="price">￥'+y.price+"</strong>"}else{if(y.priceType=="1"){z+='<strong class="price vip_price">￥'+y.price+'</strong><i class="gray">&nbsp;￥'+y.shangPinPrice+"</i>"}else{z+='<strong class="price">￥'+y.price+'</strong><i class="gray">&nbsp;￥'+y.shangPinPrice+"</i>"}}var u=false;for(var q=0;q<m.length;q++){if(m[q]["Key"]==y.skuNo){if(m[q]["Value"]=="true"){u=true;break}}}z+='<a id="sp_del" class="alShopcart_del" delno="'+y.id+'" href="javascript:;"  title="将该商品从购物车中移除" class="a-gray">删除</a>';z+="</p>";z+="</span>";z+="</li>"}z+="</ul></div>";o.html(z);if(x<2){$("#spPlug_shopcart_wrapper").stop().animate({height:"90"},100)}var l=function(){var A=addFavoriteProductFromCart($(this).attr("pNo"),$(this).attr("sNo"),$(this).attr("p"),$(this).attr("caNo"));if(A=="1"){$(this).replaceWith("<span>已收藏</span>")}};$("#spPlug_shopcart_wrapper blockquote a.a-gray").one("click",l);calculateProductCount("")}n&&n.call(this)},onfail:function(){this.container.html("正在加载")}}});SP.config.shopcart=SP.plug.shopcart()});